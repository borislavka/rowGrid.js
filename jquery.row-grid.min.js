!function(t){function e(e,a,s){for(var i,r,l,n=0,h=[],g=(s=jQuery.makeArray(s||e.querySelectorAll(a.itemSelector))).length,o=e.getBoundingClientRect(),m=Math.floor(o.right-o.left)-parseFloat(t(e).css("padding-left"))-parseFloat(t(e).css("padding-right")),d=[],f=0;f<g;++f)(i=s[f].getElementsByTagName("img")[0])?((r=parseInt(i.getAttribute("width")))||i.setAttribute("width",r=i.offsetWidth),(l=parseInt(i.getAttribute("height")))||i.setAttribute("height",l=i.offsetHeight),d[f]={width:r,height:l}):(s.splice(f,1),--f,--g);g=s.length;for(var c=0;c<g;++c){if(s[c].classList?(s[c].classList.remove(a.firstItemClass),s[c].classList.remove(a.lastItemClass),s[c].classList.remove(a.lastRowClass)):s[c].className=s[c].className.replace(new RegExp("(^|\\b)"+a.firstItemClass+"|"+a.lastItemClass+"|"+a.lastRowClass+"(\\b|$)","gi")," "),n+=d[c].width,h.push(s[c]),c===g-1)for(var p=0;p<h.length;p++){if(0===p){h[p].className+=" "+a.lastRowClass;for(var w=t(h[p]).prevAll(".gallery-item-first"),u=0;u<w.length;++u)prevRowTotalHeight+=parseInt(t(w[u]).css("height"));var v=prevRowTotalHeight/w.length}var x=c+parseInt(p)-h.length+1,M=v*d[x].width/d[x].height;h[p].style.cssText="width: "+Math.ceil(M)+"px;height: "+Math.ceil(v)+"px;margin-right:"+(p<h.length-1?a.minMargin+"px":0)}if(n+a.maxMargin*(h.length-1)>m){var C=n+a.maxMargin*(h.length-1)-m,I=h.length;if((a.maxMargin-a.minMargin)*(I-1)<C){var R=a.minMargin;C-=(a.maxMargin-a.minMargin)*(I-1)}else{R=a.maxMargin-C/(I-1);C=0}var y,A=0;for(p=0;p<h.length;p++){y=h[p];var b=d[c+parseInt(p)-h.length+1].width,N=b-b/n*C,T=Math.round(d[c+parseInt(p)-h.length+1].height*(N/b));A+1-N%1>=.5?(A-=N%1,N=Math.floor(N)):(A+=1-N%1,N=Math.ceil(N)),y.style.cssText="width: "+N+"px;height: "+T+"px;margin-right: "+(p<h.length-1?R:0)+"px",0===p&&(y.className+=" "+a.firstItemClass),p==h.length-1&&(y.className+=" "+a.lastItemClass)}h=[],n=0}}}t.fn.rowGrid=function(a){return this.each(function(){var s=t(this);if("appended"===a){a=s.data("grid-options");var i=s.children("."+a.lastRowClass),r=i.nextAll(a.itemSelector).add(i);e(this,a,r)}else a=t.extend({},t.fn.rowGrid.defaults,a),s.data("grid-options",a),e(this,a),a.resize&&t(window).on("resize.rowGrid",{container:this},function(t){e(t.data.container,a)})})},t.fn.rowGrid.defaults={minMargin:null,maxMargin:null,resize:!0,lastRowClass:"last-row",firstItemClass:null,lastItemClass:null}}(jQuery);